<div class="container">
  <div class="container mt-4 mb-4 purple">
    <h2><strong>Avaliação de <%= @review.place.name %></strong></h2>
    <br>
    <h3><%= @review.title %></h3>
  </div>
  <!-- nota do review -->
  <div class="m-3">
    <% if @review.user == current_user %>
      <span>Sua avaliação: </span>
      <!-- RATING SYSTEM -->
      <div class="rates-outer" data-rating="<%= @review.rating %>"> 
        <div class="rates-inner">
        </div>
      </div>
    <% elsif @review.is_anonymous %>
      <span> Avaliação de usuário anônimo: </span>
      <!-- RATING SYSTEM -->
      <div class="rates-outer">
        <div class="rates-inner">
        </div>
      </div>
    <% else %>
      <span> Avaliação de <%= @review.user.username %>: </span>
      <!-- RATING SYSTEM -->
      <div class="rates-outer">
        <div class="rates-inner">
        </div>
      </div>
    <% end %>
  </div>
  <!-- conteudo do review -->
  <div class="m-3">
    <% if @review.is_disabled? %>
      <p> Avaliação removida </p>
    <% else %>
      <p><%= @review.content %></p>
    <% end %>
  </div>
  <!-- response -->
  <div class="m-3">
    <% @review.responses.each do | response | %>
      <div>
        <p><%= response.response %></p>
        <p><em>Respondido por <%= response.review.place.name %> <%= "(dono)" if current_user == @review.place.owner %> </em></p>
        <hr>
      </div>
    <% end %>
    <% if policy(@review).create_response? %>
      <div>
        <p>Write a response:</p>
        <%= simple_form_for [@review, @response], method: 'post' do |f| %>
          <div>
            <%= f.input :response %>
            <%= f.submit 'Responda' %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
  <!-- links -->
  <div class="m-3">
    <% if policy(@review).edit?  %>
      <p><%= link_to edit_review_path do %></p>
        <i class="far fa-edit"></i> Edite a avaliação
      <% end %>
    <% end %>
    <br>
    <br>
    <% if policy(@review).disable? %>
      <%= link_to disable_review_path(@review) do %>
        <i class="fas fa-trash-alt"></i> Desative a avaliação 
      <% end %>
    <% end %>
    <p><%= link_to place_path(@review.place) do %></p>
      <i class="fas fa-arrow-left"></i> <%= "Voltar para #{@review.place.name}" %>
    <% end %>
    <br>
    <% if policy(@review).satisfy? %>
      <p><%= link_to "Questão resolvida?", satisfy_review_path(@review) %>
      <% end %>
    </div>
  </div>


<!-- JS SCRIPT PARA RATING CUSTOMIZADO -->
<script>
  // Rating
  let reviewRating = <%= @review.rating %>

  // Total icons
  const iconsTotal = 5;

  // Run getRating when DOM loads
  if (reviewRating) {
    document.addEventListener('DOMContentLoaded', getRating);
  };
  

  // Get rating
  function getRating() {
    // Get percentage
    const iconPercentage = (reviewRating / iconsTotal) * 100;

    // Round to nearest 
    const iconPercentageRounded = `${Math.round(iconPercentage / 10) * 10}%`;

    // Set width of rates-inner to percentage
    document.querySelector('.rates-inner').style.width = iconPercentageRounded;
  };
</script>